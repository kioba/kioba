<!doctype html>
<html>

<head>
  <title>Baby steps to Functional programming with Kotlin // Blog</title>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Karoly Somodi [Kioba]" />
  <meta name="description"
    content="" />
  <base href="https://kioba.github.io/" />
  
  <link rel="stylesheet" href="https://kioba.github.io/css/main.min.0987a026ff15a50760734f103f9cd6656d2d4167d5838ef1d86fcb64974b7e31.css" />
</head>

<body>
  <header class="app-header">
    <a href="/"><img class="app-header-avatar" src="./avatar.jpg" /></a>
    <h1>Karoly Somodi [Kioba]</h1>
    <p>Functional advocate in Kotlin and Scala</p>
    <a href="/about">
      <p>About</p>
    </a>
    <div class="app-header-social">
      
      <a target="_blank" href="https://github.com/kioba"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
      
      <a target="_blank" href="https://twitter.com/kiobaa"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      
    </div>
  </header>
  <main class="app-container">
    
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Baby steps to Functional programming with Kotlin</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Sep 27, 2017
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          3 min read
        </div></div>
    </header>
    <div class="post-content">
      <p>When I started to work with RxJava it was extremely hard to get used to the reactive way of thinking and get a grasp on those wide ranges of operators, but no matter the difficulty the benefits are clear. With reactive programming, the code becomes good structured and beautifully organized.</p>

<h2 id="iterative-solution">Iterative solution</h2>

<p>Let&rsquo;s look at a task where we have to change the font inside the TabLayout. You have to go down 3 layers deep in the TabLayout view structure to find each TextView and change the typeface for all of them.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    fun TabLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">setRegularFont</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>i in 0<span style="color:#f92672">..</span><span style="color:#a6e22e">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#75715e">// 1 range
</span><span style="color:#75715e"></span>        val child <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span>    <span style="color:#75715e">// 2 map
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>child is ViewGroup<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>         <span style="color:#75715e">// 3 filter
</span><span style="color:#75715e"></span>          <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>j in 0<span style="color:#f92672">..</span><span style="color:#a6e22e">child</span><span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            val childViewGroup <span style="color:#f92672">=</span> child<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>j<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>childViewGroup is ViewGroup<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
              <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>x in 0<span style="color:#f92672">..</span><span style="color:#a6e22e">childViewGroup</span><span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                val textView <span style="color:#f92672">=</span> childViewGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>x<span style="color:#f92672">)</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>textView is TextView<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                  textView<span style="color:#f92672">.</span><span style="color:#a6e22e">typeface</span> <span style="color:#f92672">=</span> typeface
    <span style="color:#f92672">}</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span> <span style="color:#f92672">}</span></code></pre></div>

<p>This is an iterative solution and it works exactly as we intended but it is barely readable and not maintainer friendly at all.</p>

<h2 id="functional-programming">functional programming</h2>

<p>If we look closely Observable&lt;T&gt; and Iterable&lt;T&gt; is very similar to each other, they are both just a sequence of values. They can contain zero to infinite elements, the only difference in this abstraction is that with the Observable values are separated in time, and might not exist yet, but with Iterable you donâ€™t have to count with time. The Kotlin standard library was built with this methodology in mind and we can enjoy the benefit of high order functions. Now, look at how we can modify the iterative to functional programming step by step.</p>

<ol>
<li>Range generation can be achieved much better with <code>until</code> binary function, now we can get rid of those ugly &ldquo;-1&rdquo;-s in the code.</li>
<li>Looping on a range can be handled as an Iterator. Instead of using the returned range as a for loop parameter just take the index range itself and transform into the corresponding child from the ViewGroup. The <code>map(transform: (T) -&gt; R)</code> high order function solves this for you.</li>
<li>Filtering a range based on subtype can be achieved with <code>filterIsInstance&lt;R&gt;()</code> where we filter based on the subtype.</li>
</ol>

<p>Continue executing the same on the remaining elements until you reach the third layer and set the TextViews font type.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    fun TabLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">setRegularFont</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">(</span>0 until <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>it<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">filterIsInstance</span><span style="color:#f92672">&lt;</span>ViewGroup<span style="color:#f92672">&gt;()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span> <span style="color:#f92672">{</span> child <span style="color:#f92672">-&gt;</span>
              <span style="color:#f92672">(</span>0 until child<span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span> <span style="color:#f92672">{</span> child<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>it<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">filterIsInstance</span><span style="color:#f92672">&lt;</span>ViewGroup<span style="color:#f92672">&gt;()</span>
            <span style="color:#f92672">}</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span> <span style="color:#f92672">{</span> childViewGroup <span style="color:#f92672">-&gt;</span>
              <span style="color:#f92672">(</span>0 until childViewGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span> <span style="color:#f92672">{</span> childViewGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildAt</span><span style="color:#f92672">(</span>it<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">filterIsInstance</span><span style="color:#f92672">&lt;</span>TextView<span style="color:#f92672">&gt;()</span>
            <span style="color:#f92672">}</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span> <span style="color:#f92672">{</span> it<span style="color:#f92672">.</span><span style="color:#a6e22e">typeface</span> <span style="color:#f92672">=</span> typeface <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>   </code></pre></div>

<p>This is an elegant solution and you can clearly distinguish the building blocks of the algorithm without any documentation.</p>

<h2 id="one-more-thing">One more thingâ€¦</h2>

<p>These blocks not only help you break up your code logic into peaces but helps you reason about your solution. At the second approach, you can realize we are doing the same repetitive action over and over again, the only difference is the filter type.</p>

<p>Donâ€™t fear to look back at your code and see mistakes, think of them like someone else made those silly mistakes and solve it the best way you can!</p>

<p>Move our code into an extension function which later could be useful for others as well:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    fun <span style="color:#f92672">&lt;</span>T <span style="color:#f92672">:</span> View<span style="color:#f92672">&gt;</span> ViewGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">filterChildren</span><span style="color:#f92672">()</span> <span style="color:#f92672">:</span> Iterable<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>0 until <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">childCount</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span> <span style="color:#f92672">{</span> getChildAt<span style="color:#f92672">(</span>it<span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">filterIsInstance</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;()</span>
    <span style="color:#f92672">}</span></code></pre></div>

<p>And simplify our code:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    fun TabLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextTypeface</span><span style="color:#f92672">(</span>typeface: Typeface<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      filterChildren<span style="color:#f92672">&lt;</span>ViewGroup<span style="color:#f92672">&gt;()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span> <span style="color:#f92672">{</span> filterChildren<span style="color:#f92672">&lt;</span>ViewGroup<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">}</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">flatMap</span> <span style="color:#f92672">{</span> filterChildren<span style="color:#f92672">&lt;</span>TextView<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">}</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span> <span style="color:#f92672">{</span> it<span style="color:#f92672">.</span><span style="color:#a6e22e">typeface</span> <span style="color:#f92672">=</span> typeface <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span></code></pre></div>
    </div>
  </article>

  </main>
</body>

</html>